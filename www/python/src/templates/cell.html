{% extends "base.html" %}
{% block content %}
{% set assemblage_display = assemblage_name.replace('Vickaryous & Hall assemblage', 'Assemblage') %}
<div class="row">
    <div class="col-md-8">
        <h1>{{ cell.label }}</h1>
        {% if cell.sitelink %}
        <h2>Wikipedia <a href="{{ cell.sitelink }}" target="_blank"><i class="fa fa-external-link"
                    aria-hidden="true"></i></a></h2>
        <iframe src="{{ cell.sitelink }}" width="100%" height="700px"></iframe>
        {% else %}
        <p>No Wikipedia page available for this cell type. <a
                href="https://en.wikipedia.org/w/index.php?title={{ cell.label }}&action=edit" target="_blank"
                class="btn btn-primary">Create Wikipedia Page</a></p>
        {% endif %}
        <h2>Wikidata <a href="https://www.wikidata.org/wiki/{{ cell.qid }}" target="_blank"><i
                    class="fa fa-external-link" aria-hidden="true"></i></a></h2>
        <iframe src="https://www.wikidata.org/wiki/{{ cell.qid }}" width="100%" height="300px"></iframe>

        <h2>Cell Ontology <span id="cell-ontology-link"></span></h2>
        <div id="cell-ontology-content">
            <p>Loading Cell Ontology information...</p>
        </div>
        {% if not cell.cellOntologyID %}
        <p>No Cell Ontology ID available.</p>
        {% endif %}
    </div>
    <div class="col-md-4">
        <h2>Other cells in {{ assemblage_display }}</h2>
        <ul class="content-list">
            {% for cell in assemblage_cells %}
            <li>
                <a href="{{ url_for('cell', qid=cell.qid) }}">{{ cell.label }}</a>
            </li>
            {% endfor %}
        </ul>
        <a href="{{ url_for('assemblage', name=assemblage_safe_name) }}" class="btn btn-primary mt-3">Back to
            Assemblage</a>
    </div>
</div>
<a href="/" class="btn btn-primary mt-3">Back to Home</a>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cellOntologyID = "{{ cell.cellOntologyID }}";
        if (cellOntologyID) {
            fetch(`/cell_ontology/${cellOntologyID}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('cell-ontology-content').innerHTML = `<p>${data.error}</p>`;
                    } else {
                        const link = `<a href="https://bioregistry.io/${data.id}" target="_blank" class="fa fa-external-link" aria-hidden="true"></a>`;
                        document.getElementById('cell-ontology-link').innerHTML = link;
                        let content = `<p><strong>Main label:</strong> ${data.name} (${data.id})</p>`;
                        content += `<p><strong>Definition:</strong> ${data.definition}</p>`;
                        content += `<h3>Structured relationships: </h3>`;
                        content += `<ul>`;
                        data.relationships.forEach(rel => {
                            content += `<li>${rel.relationship_label} (${rel.relationship}) -> ${rel.parent_label} (${rel.parent})</li>`;
                        });
                        content += `</ul>`;
                        document.getElementById('cell-ontology-content').innerHTML = content;
                    }
                })
                .catch(error => {
                    document.getElementById('cell-ontology-content').innerHTML = `<p>Error loading Cell Ontology information.</p>`;
                });
        } else {
            document.getElementById('cell-ontology-content').innerHTML = `<p>No Cell Ontology ID available.</p>`;
        }
    });
</script>
{% endblock %}